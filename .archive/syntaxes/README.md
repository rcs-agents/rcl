# RCL TextMate Grammar

This directory contains the TextMate grammar files for RCL syntax highlighting.

## Architecture

### Single Source of Truth
The language package is the definitive source for RCL syntax highlighting, making it reusable across different IDEs and editors that support TextMate grammars.

### File Structure
- `rcl.base.tmLanguage.json` - Base grammar auto-generated by Langium
- `rcl.tmLanguage.json` - **Final enhanced grammar (source of truth for all IDEs)**
- `core/`, `sections/`, `data-types/` - Modular grammar components (future)
- `embedded/` - Embedded language patterns (future)

### Build Process
1. **Langium generates** `rcl.base.tmLanguage.json` from `src/rcl.langium`
2. **Enhancement script** (`../scripts/build-tmlanguage.ts`) processes the base grammar:
   - Adds embedded language support (`$js>`, `$ts>`, `$>`)
   - Adds semantic patterns for better theme integration
   - Combines modular components
3. **Produces** `rcl.tmLanguage.json` - the complete, enhanced grammar

## Usage

### VSCode Extension
```json
{
  "contributes": {
    "grammars": [{
      "language": "rcl",
      "scopeName": "source.rcl",
      "path": "syntaxes/rcl.tmLanguage.json"
    }]
  }
}
```

### Other IDEs
```javascript
// Sublime Text, Atom, etc. can directly consume
import rclGrammar from 'rcl-language/syntaxes/rcl.tmLanguage.json';
```

## Embedded Language Support

The enhanced grammar supports embedded expressions:

### Single-line Expressions
- `$js> JavaScript.code.here()`
- `$ts> TypeScript.code.here()`
- `$> generic.expression.here()`

### Multi-line Expressions (Indentation-based)
```rcl
config:
  dynamicValue: $js>>>
    const result = calculateValue();
    return result.toString();
```

## Development

### Building
```bash
# Generate base grammar (run in language package)
bun run langium:generate

# Enhance grammar with embedded languages and semantic patterns
bun run build:tmlanguage

# Watch for changes
bun run watch
```

### Adding New Language Features
1. Update `src/rcl.langium` for new grammar constructs
2. Enhance `scripts/build-tmlanguage.ts` for better highlighting
3. Add modular components in `core/`, `sections/`, etc.

## Benefits

✅ **IDE Agnostic** - Any TextMate-compatible editor can use enhanced grammar
✅ **Single Source** - No duplicate tmLanguage files
✅ **Embedded Languages** - Full JavaScript/TypeScript support in expressions
✅ **Maintainable** - All grammar logic in one package
✅ **Extensible** - Easy to add new language features